<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<link rel="stylesheet" type="text/css" href="./normalize.css" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans" />
<title>pebble</title>
<style>
.repl_wrapper{
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100%;
  height: 100%;
  margin: 0px;
  border: none;
  padding: 0px;
}
.repl_wrapper > .code{
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100%;
  height: 100%;
  margin: 0px;
  border: none;
  padding: 0px;
}
.repl_wrapper > .code > .repl_source_wrap{
  position: relative;
  top: 0px;
  left: 0px;
  width: 33%;
  height: 100%;
  margin: 0px;
  border: none;
  padding: 0px;
  float: left;
  font-family: "PT Sans";
}
.repl_wrapper > .code > .repl_source_wrap > textarea{
  position: absolute;
  top: 30px;
  left: 0px;
  width: 100%;
  height: 90%;
  height: -webkit-calc(100% - 40px);
  height: -moz-calc(100% - 40px);
  height: -ie-calc(100% - 40px);
  height: -o-calc(100% - 40px);
  height: calc(100% - 40px);
  margin: 0px;
  padding: 0px;
  overflow-y: auto;
  resize: none;
  outline: none;
  font-family: "PT Sans";
  font-size: 18px;
  letter-spacing: 0em;
  word-spacing: 0em;
  word-wrap: break-word;
  white-space: pre;
}
.repl_wrapper > .code > .repl_source_wrap > .error{
  position: absolute;
  bottom: 0px;
  left: 0px;
  margin: 0px;
  border: none;
  padding: 0px;
  color: red;
  font-family: "PT Sans";
}
.run{
  position: absolute;
  top: 0px;
  right: 0px;
  width: 60px;
  height: 30px;
  font-family: "PT Sans";
}
</style>
</head>
<body>
<div class="repl_wrapper">
  <div class="code">
    <div class="repl_source_wrap">
      <div>Pebble</div>
      <textarea id="PebbleScript" row="100" spellcheck="false">
(alert "Hello Pebble")

(defn eval [exp env]
  (if
    (.isSymbol exp) (.find env exp)
    (not (.isCall exp)) exp
    (let
      [[head &amp; tail] (.toArray exp)
       operator (.eval head)]
      (if
        (or
          (.isSpecial operator)
          (.isMacro operator)
          (.isLambda operator)) (.apply operator tail env)
        debugger))))
</textarea>
      <pre class="error" id="PebbleError"></pre>
    </div>
    <div class="repl_source_wrap">
      <div>CoffeeScript</div>
      <textarea id="CoffeeScript" row="100" spellcheck="false"></textarea>
      <pre class="error" id="CoffeeError"></pre>
    </div>
    <div class="repl_source_wrap">
      <div>JavaScript</div>
      <textarea id="JavaScript" row="100" spellcheck="false"></textarea>
      <pre class="error" id="JSError"></pre>
      <button class="run" id="jRun">RUN</button>
    </div>
  </div>
</div>
<script src="./lib/coffee-script.js"></script>
<script src="./bin/pebble.js"></script>
<script type="text/javascript">
(function(){
  window.addEventListener("load", function(){
    var pebbleEl = document.getElementById("PebbleScript");
    var coffeeEl = document.getElementById("CoffeeScript");
    var jsEl     = document.getElementById("JavaScript");
    var pebbleErEl = document.getElementById("PebbleError")
    var coffeeErEl = document.getElementById("CoffeeError")
    var jsErEl     = document.getElementById("JSError");
    var jButtonEl = document.getElementById("jRun");
    pebbleEl.addEventListener("keyup", refreshP);
    coffeeEl.addEventListener("keyup", refreshC);
    jButtonEl.addEventListener("click", runCodeJ);
    if(window.sessionStorage.getItem("autosave")){
      pebbleEl.value = window.sessionStorage.getItem("autosave");
    }
    setInterval(function(){
      window.sessionStorage.setItem("autosave", pebbleEl.value);
    }, 1000);
    refreshP();
    function refreshP(){
      console.clear()
      pebbleErEl.innerHTML = "";
      coffeeErEl.innerHTML = "";
      var pebbleCode = pebbleEl.value;
      try{
        var coffeeCode = PebbleScript.coffee(pebbleCode);
      }catch(e){
        pebbleErEl.innerHTML = e;
        throw e;
      }
      coffeeEl.value = coffeeCode;
      try{
        var jsCode = CoffeeScript.compile(coffeeCode,{bare:true});
      }catch(e){
        coffeeErEl.innerHTML = e;
        throw e;
      }
      jsEl.value     = jsCode;
    }
    function refreshC(){
      coffeeErEl.innerHTML = ""
      var coffeeCode = coffeeEl.value;
      try{
        var jsCode     = CoffeeScript.compile(coffeeCode,{bare:true});
        jsEl.value     = jsCode;
      }catch(e){
        coffeeErEl.innerHTML = e;
        throw e;
      }
    }
    function runCodeJ(){
      var jsCode = jsEl.value;
      new Function(jsCode)();
    }
  });
}());
</script>
</body>
</html>